language: node_js

sudo: false

matrix:
  fast_finish: true

addons:
  sonarcloud:
    organization: "pjpimentel-github"

branches:
  only:
    - v3.0.0

install:
  - npm install

cache:
  directories:
    - node_modules
    - '$HOME/.sonar/cache'

git:
  depth: false

env:
  global:
  - GH_REPO="https://${GH_TOKEN}@github.com/pjpimentel/dots.git"

stages:
  - build and sonar

jobs:
 include:
    - stage: build and sonar
      node_js: '10'
      script:
        - npm run build
        - npm run test
        - sonar-scanner